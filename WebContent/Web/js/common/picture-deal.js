jQuery(window).load(function(){var jcrop_api,boundx,boundy,x;var imgBoxSize=$('#cropbox').attr("height");var viewImgWidth=$('#preview').attr("width");var viewImgHeight=$('#preview').attr("height");$('#cropbox').Jcrop({onChange:updatePreview,onSelect:updatePreview,aspectRatio:viewImgWidth/viewImgHeight},function(){x=1;var bounds=this.getBounds();boundx=bounds[0];boundy=bounds[1];jcrop_api=this});function updatePreview(c){$("#x").val(c.x);$("#y").val(c.y);$("#w").val(c.w);$("#h").val(c.h);$('#preview').css({width:Math.round(viewImgWidth/ c.w * boundx * imgBoxSize /boundy)+'px',height:Math.round(viewImgHeight/c.h*imgBoxSize)+'px',marginLeft:'-'+Math.round(viewImgWidth/c.w*c.x)+'px',marginTop:'-'+Math.round(viewImgHeight/c.h*c.y)+'px'})}});function uploadPhoto(one){var allowExt=".jpg,.jpeg,.png,.bmp,.gif";var fileExt=one.value.substr(one.value.lastIndexOf('.')).toLowerCase();if(allowExt.indexOf(fileExt)==-1){alert("上传图片的类型错误！仅支持jpg,gif,png,bmp,png格式图片");return}else{var ff=document.getElementById('photoForm');if(ff!=null){ff.submit()}}}function checkSubmit(){var img=$('#cropbox');if(img.attr('src')=="imgPath"){return false}}var picture=document.getElementById('file');if(picture){picture.onChange=uploadPhoto}